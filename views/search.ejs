<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A site to help Massachusetts residents find a vaccine">
    <meta name="author" content="MA Volunteers">
    <link rel="shortcut icon" type="image/x-icon" href="ma_logo.png" />
    <meta property="og:title" content="COVID-19 Vaccine Search" />
    <meta property="og:image" content="ma_logo.png"/>

    <title>COVID-19 Vaccine Search</title>

    <!-- Bootstrap core CSS -->
    <link href="<%= static_path + "/bootstrap/css/theme/" + theme + "/bootstrap.css" %>" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="<%= static_path + "/bootstrap/css/jumbotron.css" %>" rel="stylesheet">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TPH643QYMP"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-TPH643QYMP');
    </script>

  </head>

  <body>
    <div class="container">
      <div class="header">
      <div class="collapse navbar-collapse" id="navbarNav" style="float:right">
        <ul class="nav nav-pills pull-right">
          <li><a href="/">COVID-19 Vaccine Availability</a></li>
          <li class="active"><a href="/search">Search Near Me</a></li>
          <li><a href="/eligibility">Eligibility</a></li>
          <li><a href="/sites">Vaccination Sites</a></li>
          <li><a href="/FAQ" >Who We Are</a></li>
        </ul>
      </div>
      <div class="nav-mobile"  style="display:none">
        <ul class="nav nav-pills pull-right" id="navbarNav" style="float:right">
          <li ><a href="/">Home</a></li>
          <li class="active"><a href="/search">Search</a></li>
          <li><a href="/eligibility">Elig.</a></li>
          <li><a href="/sites">Sites</a></li>
          <li><a href="/FAQ" >FAQ</a></li>
        </ul>
      </div>
      <div>  <h3 class="text-muted" ><img src = "ma_logo.png" style = "height:1em; "> Vaccinate MA</h3>
      </div>

      </div>
	  <% if (flask_debug === 'true') { %>
    <% } %>
      <div class = "jumbotron">
        <h2>Search Near Me</h2>
        <p class="lead">We check the availability of every provider found on the <a href="https://vaxfinder.mass.gov" target="_blank"> state website</a></p>

        <div class = "container">
          <div class = "row">
            <div class="relative max-w-xs">
              <form id="signupForm" role="form">
                   <div class="form-group" >
                     <label for="type">Find </label>
                     <select class="form-control" name="siteType" id="siteType" >
                       <option>Sites with reported doses</option>
                       <option>All known vaccination sites</option>
                     </select>
                   </div>
                   <p> near </p>
                   <button id="geolocate" type="button" class="btn btn-primary">My Location</button>
                   <div class="form-group">
                     <span> or near</span>
                     <input type="text" class="form-control" id="zipCode" name="zipCode" placeholder="5-digit zip code" required="" patter="[0-9]{5}">
                   </div>
              </form>
              <button id="signup" type="button" class="btn btn-primary">Search By Zip Code</button>

            </div>
          </div>
      </div>
      </div>

      <ul id="sites" class = "list-group">
        <li class="list-group-item" display="none" id = "firstplace" style="display:none">
          <div class="">
          </div>
          <h4 class="" id = "site_title_1">XXX</h4>
          <div style="background-color:#f5f5f0">
          <div class="site_address mb-2 flex flex-row items-center">
            <svg height="18" viewBox="0 0 21 21" width="18" xmlns="http://www.w3.org/2000/svg" class="mr-1">
              <g fill="none" fill-rule="evenodd" stroke="#6B7280" stroke-linecap="round" stroke-linejoin="round" transform="translate(4 2)">
                <path d="m6.5 16.5407715c4-4.4500928 6-7.78586659 6-10.00732153 0-3.33218241-2.6862915-6.03344997-6-6.03344997s-6 2.70126756-6 6.03344997c0 2.22145494 2 5.55722873 6 10.00732153z"></path>
                <circle cx="6.5" cy="6.5" r="2.5"></circle>
              </g>
            </svg>
            <a id = "site_address_1" class="underline" href="https://www.google.com/maps/dir/" target="_blank">xxx</a>
          </div>
          <div class="">
            <div class="">
              <div class="" id = "latest_report_1">Latest report: N/A</div>

        <dt class="">Details</dt>
        <dd class="" id = "details_1">Error</dd>

        <dt class="">Availability</dt>
        <dd class="" id = "latest_info_1">Error </dd>
        <dt class="">Book Now</dt>
        <dd class="" id = "book_1">Error </dd>
        </div>
            </div>
          </div>
        </li>
        <li class="list-group-item" display="none" style="display:none" id = "secondplace">
          <div class="">
          </div>
          <h4 class="" id = "site_title_2">XXX</h4>
          <div style="background-color:#f5f5f0">
          <div class="site_address mb-2 flex flex-row items-center">
            <svg height="18" viewBox="0 0 21 21" width="18" xmlns="http://www.w3.org/2000/svg" class="mr-1">
              <g fill="none" fill-rule="evenodd" stroke="#6B7280" stroke-linecap="round" stroke-linejoin="round" transform="translate(4 2)">
                <path d="m6.5 16.5407715c4-4.4500928 6-7.78586659 6-10.00732153 0-3.33218241-2.6862915-6.03344997-6-6.03344997s-6 2.70126756-6 6.03344997c0 2.22145494 2 5.55722873 6 10.00732153z"></path>
                <circle cx="6.5" cy="6.5" r="2.5"></circle>
              </g>
            </svg>
            <a id = "site_address_2" class="underline" href="https://www.google.com/maps/dir/" target="_blank">xxx</a>
          </div>
          <div class="">
            <div class="">
              <div class="" id = "latest_report_2">Latest report: N/A</div>

        <dt class="">Details</dt>
        <dd class="" id = "details_2">xxx</dd>

        <dt class="">Availability</dt>
        <dd class="" id = "latest_info_2">xxx </dd>
        <dt class="">Book Now</dt>
        <dd class="" id = "book_2">xxx </dd>
        </div>
            </div>
          </div>
        </li>
        <li class="list-group-item" display="none" style="display:none" id = "thirdplace">
          <div class="">
          </div>
          <h4 class="" id = "site_title_3">XXX</h4>
          <div style="background-color:#f5f5f0">
          <div class="site_address mb-2 flex flex-row items-center">
            <svg height="18" viewBox="0 0 21 21" width="18" xmlns="http://www.w3.org/2000/svg" class="mr-1">
              <g fill="none" fill-rule="evenodd" stroke="#6B7280" stroke-linecap="round" stroke-linejoin="round" transform="translate(4 2)">
                <path d="m6.5 16.5407715c4-4.4500928 6-7.78586659 6-10.00732153 0-3.33218241-2.6862915-6.03344997-6-6.03344997s-6 2.70126756-6 6.03344997c0 2.22145494 2 5.55722873 6 10.00732153z"></path>
                <circle cx="6.5" cy="6.5" r="2.5"></circle>
              </g>
            </svg>
            <a id = "site_address_3" class="underline" href="https://www.google.com/maps/dir/" target="_blank">xxx</a>
          </div>
          <div class="">
            <div class="">
              <div class="" id = "latest_report_3">Latest report: N/A</div>

        <dt class="">Details</dt>
        <dd class="" id = "details_3">xxx</dd>

        <dt class="">Availability</dt>
        <dd class="" id = "latest_info_3">xxx </dd>
        <dt class="">Book Now</dt>
        <dd class="" id = "book_3">xxx </dd>
        </div>
            </div>
          </div>
        </li>
        <li class="list-group-item" display="none" style="display:none" id = "fourthplace">
          <div class="">
          </div>
          <h4 class="" id = "site_title_4">XXX</h4>
          <div style="background-color:#f5f5f0">
          <div class="site_address mb-2 flex flex-row items-center">
            <svg height="18" viewBox="0 0 21 21" width="18" xmlns="http://www.w3.org/2000/svg" class="mr-1">
              <g fill="none" fill-rule="evenodd" stroke="#6B7280" stroke-linecap="round" stroke-linejoin="round" transform="translate(4 2)">
                <path d="m6.5 16.5407715c4-4.4500928 6-7.78586659 6-10.00732153 0-3.33218241-2.6862915-6.03344997-6-6.03344997s-6 2.70126756-6 6.03344997c0 2.22145494 2 5.55722873 6 10.00732153z"></path>
                <circle cx="6.5" cy="6.5" r="2.5"></circle>
              </g>
            </svg>
            <a id = "site_address_4" class="underline" href="https://www.google.com/maps/dir/" target="_blank">XXX</a>
          </div>
          <div class="">
            <div class="">
              <div class="" id = "latest_report_4">Latest report: N/A</div>

        <dt class="">Details</dt>
        <dd class="" id = "details_4">XXX</dd>

        <dt class="">Availability</dt>
        <dd class="" id = "latest_info_4">XXX </dd>
        <dt class="">Book Now</dt>
        <dd class="" id = "book_4">XXX. </dd>
        </div>
            </div>
          </div>
        </li>
        <li class="list-group-item" display="none" style="display:none" id = "fifthplace">
          <div class="">
          </div>
          <h4 class="" id = "site_title_5">XXX</h4>
          <div style="background-color:#f5f5f0">
          <div class="site_address mb-2 flex flex-row items-center">
            <svg height="18" viewBox="0 0 21 21" width="18" xmlns="http://www.w3.org/2000/svg" class="mr-1">
              <g fill="none" fill-rule="evenodd" stroke="#6B7280" stroke-linecap="round" stroke-linejoin="round" transform="translate(4 2)">
                <path d="m6.5 16.5407715c4-4.4500928 6-7.78586659 6-10.00732153 0-3.33218241-2.6862915-6.03344997-6-6.03344997s-6 2.70126756-6 6.03344997c0 2.22145494 2 5.55722873 6 10.00732153z"></path>
                <circle cx="6.5" cy="6.5" r="2.5"></circle>
              </g>
            </svg>
            <a id = "site_address_5" class="underline" href="https://www.google.com/maps/dir/" target="_blank">XXX</a>
          </div>
          <div class="">
            <div class="">
              <div class="" id = "latest_report_5">Latest report: N/A</div>

        <dt class="">Details</dt>
        <dd class="" id = "details_5">XXX</dd>

        <dt class="">Availability</dt>
        <dd class="" id = "latest_info_5">XXX </dd>
        <dt class="">Book Now</dt>
        <dd class="" id = "book_5">XXX. </dd>
        </div>
            </div>
          </div>
        </li>
      </ul>

      <div class="footer">
        <p>An effort by a group of Massachusetts volunteers. <a href="https://docs.google.com/forms/d/e/1FAIpQLSel9cjb4X0Zv5zuygWx9UnXpXrP2INJTrOW7j9MNXNdv7lKnw/viewform">Let us know if you found this site useful!</a></p>
        <p> This site was put together by volunteers using our best efforts to assemble readily available data from public sources. This site does not provide medical advice, nor does it provide any type of technical advice. vaccinatema.com is not responsible for any errors or omissions. </p>
      </div>
    </div> <!-- /container -->

    <script src="<%= static_path + "/jquery/jquery-1.11.3.min.js" %>"></script>
    <script src="<%= static_path + "/bootstrap/js/bootstrap.min.js" %>"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script language="javascript" src="https://maps.google.com/maps/api/js?key=AIzaSyDLApAjP27_nCB5BbfICaJ0sJ1AmmuMkD0"></script>
    <script type="text/javascript">
    var months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
    $(document).ready(function() {
        function timeConverter(string) {
            var dates = (string || '').split('-');
            if (dates.length !=3) {
                return '';
            }
            var month = months[parseInt(dates[1]) - 1];
            var date = dates[2].substring(0,2);
            return 'Latest report: ' + month + ' ' + date;
        }
        function getLatLngByZipcode(zipcode, myCallback) {
            var geocoder = new google.maps.Geocoder();
            var address = zipcode;
            geocoder.geocode({ 'address': 'zipcode '+address }, function (results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    var latitude = results[0].geometry.location.lat();
                    var longitude = results[0].geometry.location.lng();
                    myCallback({coords: {latitude, longitude}})
                } else {
                    return {coords: {}};
                }
            });
        }
        function linkify(str) {
            const linkify_regex = /(<a href=")?((https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)))(">(.*)<\/a>)?/gi;
            return str.replace(linkify_regex, function () {
                return '<a href="' + arguments[2] + '">' + (arguments[7] || arguments[2]) + '</a>'
            });
        }
        function displayLocation(location, placeId, n) {
            var addr = location.fields["Full Address"] || '';
            $(placeId).show();
            $("#site_title_" + n).text(location.fields["Location Name"]);
            $("#site_address_" + n).text(addr);
            $("#site_address_" + n).attr("href", "https://maps.google.com/?q=" + addr.replace(" ","+"));
            $("#details_" + n).text(location.fields["Serves"] || '');
            $("#book_" + n).html(linkify(String(location.fields["Book an appointment"]) || ''));
            $("#latest_info_" + n).text(location.fields["Availability"] || '');
            $("#latest_report_" + n).text(timeConverter(String(location.fields["Last Updated"])));
        }
        function displayData(data) {
            displayLocation(data[0], '#firstplace', '1');
            $('ul#sites')[0].scrollIntoView({behavior: "smooth", block: "start", inline: "nearest"});
            displayLocation(data[1], '#secondplace', '2');
            displayLocation(data[2], '#thirdplace', '3');
            displayLocation(data[3], '#fourthplace', '4');
            displayLocation(data[4], '#fifthplace', '5');
        }
        function postLocation(pos) {
            var crd = {...pos.coords, "availability": $('#siteType').val()};
            $.post( "/search_query_location", crd).done(displayData).error(console.log)
        }
        $("#signup").click(function() {
            console.log($("#zipCode").val());
            getLatLngByZipcode($("#zipCode").val(),postLocation);
        });
        $("#geolocate").click(function() {
            if (window.navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(postLocation,console.log);
            }
        });
    })
    </script>
  </body>
</html>
